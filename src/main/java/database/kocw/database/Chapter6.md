# 6장 정규화     

  

## 정규화의 개념과 이상 현상 
## 함수 종속 
## 기본 정규형과 정규화 과정 
<img width="1054" alt="스크린샷 2023-02-16 오후 8 26 12" src="https://user-images.githubusercontent.com/115435784/219352491-a7d2370d-2828-4d7b-9e08-f031c148b998.png">
  
- 정규화의 필요성과 이상 현상의 의미를 이해한다.  
- 정규화를 수행하기 위해 함수 종속성의 개념을 이해한다.  
- 정규형의 유형과 관계를 이해하고, 실제 예를 통해 정규화 과정을 연습해본다.   
  

### 정규화의 개념과 이상 현상  
  
- **이상(anomaly) 현상** 
  - 불필요한 데이터 중복으로 인해 릴레이션에 대한 데이터 삽입 수정 삭제 연산을 수행할 때 발생할 수 있는 부작용 
  
- **정규화** 
  - 이상 현상을 제거하면서 데이터베이스를 올바르게 설계해나가는 과정   

- **이상 현상의 종류** 
  - 삽입 이상 : 새 데이터를 삽입하기 위해 불필요한 데이터도 함께 삽입해야 하는 문제 
  - 갱신 이상 : 중복 투플 중 일부만 변경하여 데이터가 불일치하게 되는 모순의 문제  
  - 삭제 이상 : 투플을 삭제하면 꼭 필요한 데이터까지 함께 삭제되는 데이터 손실의 문제  

<img width="955" alt="스크린샷 2023-02-16 오후 8 29 52" src="https://user-images.githubusercontent.com/115435784/219353250-897dbcc1-67ee-474a-8657-50d3ab18d7c0.png">
  
- **삽입 이상(insertion anomaly)** 
  - 릴레이션에 새 데이터를 삽입하려면 불필요한 데이터도 함께 삽입해야 하는 문제  
  
  - 삽입 이상이 발생하는 예 
    - 아래 그림의 이벤트참여 릴레이션은 삽입 이상이 발생함 
      - 아직 이벤트에 참여하지 않은 아이디가 "melon"이고, 이름이 "성원용", 등급이 "gold"인 신규 고객 데이터는 이벤트참여 릴레이션에 삽입할 수 없음 
      - 삽입하려면 실제로 참여하지 않은 임시 이벤트 번호를 삽입해야 함   

<img width="1153" alt="스크린샷 2023-02-16 오후 8 32 26" src="https://user-images.githubusercontent.com/115435784/219353731-2bc8b2ca-768f-4aa5-85ff-803035707de6.png">

---  
- **갱신 이상(update anomaly)** 
  - 릴레이션의 중복된 투플들 중 일부만 수정하여 데이터가 불일치하게 되는 모순이 발생하는 문제 
  - 갱신 이상이 발생하는 예 
    - 아이디가 "apple"인 고객의 등급이 "gold"에서 "vip"로 변경되었는데, 일부 투플에 대해서만 등급이 수정된다면 "apple"고객이 서로 다른 등급을 가지는 모순이 발생    
      <img width="1166" alt="스크린샷 2023-02-16 오후 8 35 06" src="https://user-images.githubusercontent.com/115435784/219354253-ac4c20d7-a990-4014-8a11-09c4c236d62d.png">
  
- **삭제 이상(deletion anomaly)**
  - 릴레이션에서 투플을 삭제하면 꼭 필요한 데이터까지 손실되는 연쇄 삭제 현상이 발생하는 문제 
  - 삭제 이상이 발생하는 예 
    - 그림의 이벤트참여 릴레이션은 삭제 이상이 발생함  
      - 아이디가 "orange"인 고객이 이벤트 참여를 취소해 관련 투플을 삭제하게 되면 이벤트 참여와 관련이 없는 고객아이디, 고객 이름, 등급 데이터까지 손실  

<img width="1155" alt="스크린샷 2023-02-16 오후 8 37 35" src="https://user-images.githubusercontent.com/115435784/219354742-685d4029-e6dc-4a9d-8eed-ce251b99acd5.png">
  
---  
- **정규화** 
  - 이상 현상이 발생하지 않도록, 릴레이션을 관련 있는 속성들로만 구성하기 위해 릴레이션을 분해(decomposition) 하는 과정 
  - **함수적 종속성**을 판단하여 정규화를 수행함 
  
- **함수적 종속성(FD; Functional Dependency)** 
  - 속성들 간의 관련성 
  - 함수 종속성을 이용하여, 릴레이션을 연관성이 있는 속성들로만 구성되도록 분해하여, 이상현상이 발생하지 않는 바람직한 릴레이션으로 만들어 나가는 과정이 정규화  
  
### 함수 종속 
- **함수 종속** 
  - X가 Y를 함수적으로 결정한다. 
    - 릴레이션 내의 모든 투플을 대상으로 하나의 X값에 대한 Y값이 항상 하나이다. 
    - X와 Y는 하나의 릴레이션을 구성하는 속성들의 부분 집합 
    - Y가 X에 함수적으로 종속되어 있다와 같은 의미 
    - X->Y로 표현 (X는 결정자, Y는 종속자)  

<img width="676" alt="스크린샷 2023-02-16 오후 8 40 52" src="https://user-images.githubusercontent.com/115435784/219355444-a1ce56d0-eeae-4fd8-8532-93694514871f.png">
  
---  
- **함수 종속 관계 판단 예(1)**

<img width="1153" alt="스크린샷 2023-02-16 오후 8 43 59" src="https://user-images.githubusercontent.com/115435784/219356150-fb434c00-addf-42d0-b4ee-3565ed5d9a3b.png">
  
고객 아이디 -> 고객이름  
고객 아이디 -> 등급  
이렇게 종속관계이다.    
하나의 X값에 하나의 Y값이 매칭되어야 함수관계이다.   
즉 고객 아이디 속성 값에 대응되는 고객 이름 속성과 등급 속성값이 단 하나이다.  

<img width="1150" alt="스크린샷 2023-02-16 오후 8 46 33" src="https://user-images.githubusercontent.com/115435784/219356650-dc4adc2c-9107-4cd3-929e-5ef54c2c8cc5.png">
  
- **함수 종속 관계 판단 시 유의 사항** 
  - 속성 자체의 특성과 의미를 기반으로 함수 종속성을 판단해야 함 
    - 속성 값은 계속 변할 수 있으므로, 현재 릴레이션에 포함된 속성 값만으로 판단하면 안된다.  
  
  - 일반적으로 기본키와 후보키는 릴레이션의 다른 모든 속성들을 함수적으로 결정함 
  
  - 기본키나 후보키가 아니어도 다른 속성 값을 유일하게 결정하는 속성은 함수 종속 관계에서 결정자가 될 수 있음    

<img width="1136" alt="스크린샷 2023-02-16 오후 8 51 22" src="https://user-images.githubusercontent.com/115435784/219357647-5313db9e-42ad-4694-a34f-8ccd59ac4bf3.png">

<img width="1186" alt="스크린샷 2023-02-16 오후 8 52 29" src="https://user-images.githubusercontent.com/115435784/219357880-b00e12a6-b166-4170-8398-53aab9ad8ee5.png">
  
---  
- **완전 함수 종속 (FFD; Full Functional Dependency)** 
  - 릴레이션에서 속성 집합 Y가 속성 집합 X에 함수적으로 종속되어 있지만,  
  - 속성집합 X의 전체가 아닌 일부분에는 종속되지 않음을 의미  
  
  - 일반적으로 함수 종속은 완전 함수 종속을 의미함  
  
  - 예) 당첨 여부는 {고객 아이디, 이벤트 번호}에 완전 함수 종속됨 
  
- **부분 함수 종속(PFD; Partial Functional Dependency)** 
  - 릴레이션에서 속성 집합 Y가 속성 집합 X의 전체가 아닌 일부분에도 함수적으로 종속됨을 의미 
  - 예) 고객 이름은 {고객 아이디, 이벤트 번호}에 부분 함수 종속됨   
  
  
- **이행적 함수 종속(transitive FD)** 
  - 릴레이션을 구성하는 세 개의 속성 집합 X,Y,Z에 대해 함수 종속관계 X->Y 와 Y->Z 가 존재하면 논리적으로 X->Z가 성립되는데, 이것을 Z가 X에 이행적으로 함수 종속되었다고 함   
  
- **고려할 필요가 없는 함수 종속 관계** 
  - 결정자와 종속자가 같거나, 결정자가 종속자를 포함하는 것처럼 당연한 함수종속 관계는 고려하지 않음   

<img width="1019" alt="스크린샷 2023-02-16 오후 8 58 40" src="https://user-images.githubusercontent.com/115435784/219359052-3d523f07-f9af-4c4a-bd76-3393336088f0.png">

---
  
# 기본 정규형과 정규화 과정
  
- **정규화(normalization)** 
  - 함수 종속성을 이용해 릴레이션을 연관성이 있는 속성들로만 구성되도록 분해해서, 이상현상이 발생하지 않는 바람직한 릴레이션으로 만들어가는 과정  
    - 이상현상 : 삽입 갱신 삭제 이상 
  
  - 정규화를 통해 릴레이션은 **무손실 분해(nonless decomposition)**되어야 한다.  
    - 릴레이션은 의미적으로 동등한 릴레이션들로 분해되어야 하고, 분해로 인한 정보의 손실이 발생하지 않아야 한다.  
    - 분해된 릴레이션들을 자연 조인하면 분해 전의 릴레이션으로 복원 가능해야 한다. 
  
- **정규형(NF; Normal Form)** 
  - 릴레이션이 정규화된 정도 
  - 각 정규형마다 제약조건이 존재 
    - 정규형의 차수가 높아질수록 요구되는 제약조건이 많아지고 엄격해짐  
    - 정규형의 차수가 높아질수록 데이터 중복이 줄어 이상현상이 발생하지 않는 바람직한 릴레이션이 됨 
  - 릴레이션의 특성을 고려아여 적합한 정규형을 선택   

<img width="1132" alt="스크린샷 2023-02-17 오전 10 05 32" src="https://user-images.githubusercontent.com/115435784/219523222-b507f295-a8ac-4266-98d2-6e4a8fb0ad96.png">
  
본 수업은 보이스/코드 정규형까지   

<img width="1080" alt="스크린샷 2023-02-17 오전 10 06 23" src="https://user-images.githubusercontent.com/115435784/219523323-2c69e5df-533c-414c-8612-596f09424f63.png">
  
- **제 1 정규형 (1NF; First Normal Form)** 
  - 릴레이션의 모든 속성이 더는 분해되지 않는 원자값만 가지며, 제 1정규형을 만족함 
  - 제 1 정규형을 만족해야 관계 데이터베이스의 릴레이션이 될 자격이 있음  

<img width="1068" alt="스크린샷 2023-02-17 오전 10 07 48" src="https://user-images.githubusercontent.com/115435784/219523508-7b17f065-3e0e-4469-8272-4b3c52e39ef4.png">
  
**이벤트번호, 당첨여부가 다중값을 가지기 때문에 제 1 정규형을 만족하지 못한다.**  

<img width="1160" alt="스크린샷 2023-02-17 오전 10 08 25" src="https://user-images.githubusercontent.com/115435784/219523595-293e2c49-9d6f-477c-b20e-05b7941634c8.png">
  
다중값들을 투플로 분해하여서 나타내었다. 

1 정규형은 원자값으로만 이루어졌지 이상현상이 발생하기 쉽다.    

<img width="1173" alt="스크린샷 2023-02-17 오전 10 11 54" src="https://user-images.githubusercontent.com/115435784/219523986-43727e57-a180-4db0-b2e1-e0ff8eec25fb.png">

<img width="1175" alt="스크린샷 2023-02-17 오전 10 13 35" src="https://user-images.githubusercontent.com/115435784/219524190-04295ec1-092d-4810-a605-0baeb571ad29.png">
  
- **제 1 정규형은 만족하지만, 이상 현상이 발생하는 릴레이션 예** 
  - 이상현상의 발생 이유 
    - 기본키인 {고객 아이디, 이벤트번호}에 완전 함수 종속되지 못하고, 일부분인 고객아이디에 종속되는 등급과 할인율 속성이 존재하기 때문  
  
  - 문제해결 방법 
    - 부분함수 종속이 제거되도록 이벤트참여 릴레이션을 분해 -> 분해된 릴레이션은 제 2 정규형에 속하게 된다.    
  
  
- **제 2 정규형(2NF; Second Normal Form)** 
  - 릴레이션이 제 1 정규형에 속사혹, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되면 제 2 정규형을 만족함   

<img width="1123" alt="스크린샷 2023-02-17 오전 10 21 07" src="https://user-images.githubusercontent.com/115435784/219525279-885e6993-8cf1-4083-85c5-abeda598191e.png">

<img width="1142" alt="스크린샷 2023-02-17 오전 10 22 23" src="https://user-images.githubusercontent.com/115435784/219525462-9d6d79b3-f6da-411c-9e6b-56f5f8a3bd3f.png">

<img width="1187" alt="스크린샷 2023-02-17 오전 10 22 57" src="https://user-images.githubusercontent.com/115435784/219525518-08b69514-3fc9-490e-926f-187603b2cd4e.png">

<img width="1153" alt="스크린샷 2023-02-17 오전 10 23 45" src="https://user-images.githubusercontent.com/115435784/219525623-f037f29d-961c-4316-a52a-c91325dc8682.png">

<img width="1152" alt="스크린샷 2023-02-17 오전 10 24 32" src="https://user-images.githubusercontent.com/115435784/219525720-02503a42-687e-4f4d-934e-624d5a273911.png">
  
- **제2 정규형은 만족하지만, 이상 현상이 발생하는 릴레이션 예** 
  - 이상현상의 발생 이유 
    - 이행적 함수 종속이 존재하기 때문  
  
  - 문제해결 방법? 
    - 이행적 함수 종속이 제거되도록 고객 릴레이션을 분해 
    - 분해된 릴레이션은 제3 정규형에 속하게 된다. 
  
- **제3 정규형(3NF; Third Normal Form)** 
  - 릴레이션이 제2 정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속되지 않으면 제3 정규형을 만족함  

<img width="1124" alt="스크린샷 2023-02-17 오전 10 41 19" src="https://user-images.githubusercontent.com/115435784/219527866-5c8e3a4a-af8a-487a-b15d-9f3d117b5d43.png">

<img width="1159" alt="스크린샷 2023-02-17 오전 10 42 33" src="https://user-images.githubusercontent.com/115435784/219528053-653f680c-e784-45ba-bac9-d67c95a51cc7.png">

<img width="1180" alt="스크린샷 2023-02-17 오전 10 43 38" src="https://user-images.githubusercontent.com/115435784/219528138-790b06d3-41fa-4079-a154-b02cee7fa44f.png">

<img width="561" alt="스크린샷 2023-02-17 오후 4 32 17" src="https://user-images.githubusercontent.com/115435784/219579359-cd513925-c391-46e6-92bb-89d88708eddc.png">
  
  
한명의 학생이 여러과목을 수강하면, 동일한 학생에 대해 지도교수 회장이름등 학번만으로 속성들의 정보들도 중복되어서 투플에 기재되어 있습니다.  
지도교수가 A에서 B로 바뀐다면, 학번 -> 뒤에가 모두 갱신이 되어야 하는데, 일부는 갱신되고 일부는 안되면, 동일한 학생인데 지도교수가 달라지는 갱신이상이 발생할 수 있다.

  
- **모든 릴레이션이 제2 정규형을 만족하도록 분해하고, 각 릴레이션의 기본키를 표시하시오** 

![IMG_C126B8CD6FC6-1](https://user-images.githubusercontent.com/115435784/219582986-662855a3-224d-41ba-a0db-e238717ffe61.jpeg)

- **제2 정규형의 릴레이션이 제3 정규형을 만족하도록 분해하고, 각 릴레이션의 기본키도 표시하시오** 

![IMG_F57CEFCEDD0F-1](https://user-images.githubusercontent.com/115435784/219584614-8b5cd26f-a2ce-4b0d-a4ad-ceb504eda612.jpeg)













  