# 5장. 관계 데이터 모델 
- 관계 데이터 모델의 개념 
- 관계 데이터 모델의 제약  
  션
## 학습 목표 
![스크린샷 2023-02-14 오후 7 26 07](https://user-images.githubusercontent.com/115435784/218708625-5d01553e-bc46-4650-a4e5-c7dbe59362cd.png)
  
- 관계 데이터 모델의 기본 용어를 익힌다.  
- 릴레이션을 구성하는 요소와 특성을 이해한다.  
- 릴레이션에서 키의 역할과 종류를 알아본다. 
- 무결성 제약의 의미와 필요성을 이해한다.  
  
### 데이터베이스 설계 단계  
- 데이터베이스 설계 
  - 사용자의 다양한 요구 사항을 고려하여 데이터베이스를 생성하는 과정 
  - E-R 모델과 릴레이션 변환 규칙을 이용한 설계의 과정  

![스크린샷 2023-02-14 오후 7 29 03](https://user-images.githubusercontent.com/115435784/218709349-fc6f6d50-d817-4a03-bd86-dc1b30a68fe3.png)
  
- E-R 모델과 릴레이션 변환 규칙을 이용한 설계의 과정   

![스크린샷 2023-02-14 오후 7 29 57](https://user-images.githubusercontent.com/115435784/218709530-d307fd1c-340f-4950-ae91-3808848ea3b7.png)
  
### 관계 데이터 모델의 개념 
- 관계 데이터 모델의 기본 개념 
  - 개념적 구조를 논리적 구조로 표현하는 논리적 데이터 모델 
  - 하나의 개체에 대한 데이터를 하나의 릴레이션에 저장  

![스크린샷 2023-02-14 오후 7 31 14](https://user-images.githubusercontent.com/115435784/218709856-7240ffc3-13b5-4fcc-b40e-19996607b0cd.png)
  
- **관계 데이터 모델의 기본 용어** 
  - 릴레이션 (relation) 
    - 하나의 개체에 관한 데이터를 2차원 테이블의 구조로 저장한 것 
    - 파일 관리 시스템 관점에서 파일(file)에 대응 
  
  - 속성 (attribute) 
    - 릴레이션의 열, 애트리뷰트 
    - 파일 관리 시스템 관점에서 필드(field)에 대응 
  
  - 투플 (tuple)
    - 릴레이션의 행 
    - 파일 관리 시스템 관점에서 레코드(record)에 대응   
  
  - 도메인 (domain) 
    - 하나의 속성이 가질 수 있는 모든 값의 집합 
    - 속성 값을 입력 및 수정할 때 적합성의 판단 기준이 됨 
    - 일반적으로 속성의 특성을 고려한 타입으로 정의 
  
  - 널 (null) 
    - 속성 값을 아직 모르거나, 해당되는 값이 없음을 표현  
  
  - 차수 (degree) 
    - 하나의 릴레이션에서 속성의 전체 개수 
  
  - 카디널리티 (cardinality) 
    - 하나의 릴레이션에서 투플의 전체 개수   


![스크린샷 2023-02-14 오후 7 41 17](https://user-images.githubusercontent.com/115435784/218712235-e41cfadf-00e4-4abf-89ba-835185709538.png)
  
정답 :
- 도메인 
- 6
- 4

  
- **릴레이션의 구성** 
  - 릴레이션 스키마(relation schema)
    - 릴레이션의 논리적 구조 
    - 릴레이션의 이름과 릴레이션에 포함된 모든 속성 이름으로 정의 
    - 예) 고객(고객 아이디, 고객 이름, 나이, 등급, 직업, 적립금) 
    - 릴레이션 내포(relation intention)라고도 함  
    - 정적인 특징이 있음 
  
  - 릴레이션 인스턴스 (relation instance) 
    - 어느 한 시점에 릴레이션에 존재하는 투플들의 집합 
    - 릴레이션 외연(relation extension)이라고도 함
    - 동적인 특징이 있음  
  
  
- **데이터베이스의 구성** 
  - 데이터베이스 스키마 
    - 데이터베이스의 전체 구조 
    - 데이터베이스를 구성하는 릴레이션 스키마의 모음 
  

  - 데이터베이스 인스턴스
    - 데이터베이스를 구성하는 릴레이션 인스턴스의 모음  

![스크린샷 2023-02-14 오후 7 48 46](https://user-images.githubusercontent.com/115435784/218713886-6f88b428-d03a-4c6d-9e2c-eb4a7d1122e3.png)
     
- **릴레이션의 특성** 
  - 투플의 유일성 
    - 하나의 릴레이션에는 동일한 투플이 존재할 수 없다.  
  - 투플의 무순서 
    - 하나의 릴레이션에서 투플 사이의 순서는 무의미하다.  
  - 속성의 무순서 
    - 하나의 릴레이션에서 속성 사이의 순서는 무의미하다. 
  - 속성의 원자성 
    - 속성 값으로 원자값만 사용할 수 있다.  

![스크린샷 2023-02-14 오후 7 59 55](https://user-images.githubusercontent.com/115435784/218716518-001d6635-3cdb-4cd6-81e1-beacdb2e03d5.png)
  
 - **키(key)** 
   - 릴레이션에서 투플들을 유일하게 구별하는 속성 또는 속성들의 집합   

![스크린샷 2023-02-14 오후 8 04 19](https://user-images.githubusercontent.com/115435784/218718276-4cd5d3c2-8344-4d3e-8f47-8bd783b1d4fc.png)
  
- **키의 특성** 
  - 유일성 (uniqueness)
    - 하나의 릴레이션에서 모든 투플은 서로 다른 키 값을 가져야 함 
  - 최소성 (minimality) 
    - 꼭 필요한 최소한의 속성들로만 키를 구성   
  
- **키의 종류** 
  - **슈퍼키(super key)** 
    - **유일성**을 만족하는 속성 또는 속성들의 집합  
      ![스크린샷 2023-02-14 오후 8 08 10](https://user-images.githubusercontent.com/115435784/218719353-9b1e0840-b515-4f9f-82de-63e100065b97.png)

  - **후보키(candidate key)** 
    - **유일성**과 **최소성**을 만족하는 속성 또는 속성들의 집합  
    - 예) 고객 릴레이션의 후보키 : 고객 아이디,(고객 이름, 주조)등   
  
  - **기본키(primary key)** 
    - 후보키 중에서 기본적으로 사용하기 위해 선택한 키 
      - 널값을 가질 수 있는 속성이 포함된 후보키는 부적합 
      - 값이 자주 변경될 수 있는 속성이 포함된 후보키는 부적합 
      - 단순한 후보키를 선택  
  
  - **대체키(alternate key)** 
    - 기본키로 선택되지 못한 후보키   

![스크린샷 2023-02-14 오후 8 15 04](https://user-images.githubusercontent.com/115435784/218720870-cab607af-e4d1-4fae-b9b6-04f7b801cb67.png)
  
  - **외래키(foreign key)** 
    - 다른 릴레이션의 기본키를 참조하는 속성 또는 속성들의 집합 
    - 릴레이션들 간의 관계를 표현 
      - 참조하는 릴레이션 : 외래키를 가진 릴레이션 (주문 릴레이션) 
      - 참조되는 릴레이션 : 외래키가 참조하는 기본키를 가진 릴레이션 (고객 릴레이션)

![스크린샷 2023-02-14 오후 8 20 10](https://user-images.githubusercontent.com/115435784/218722242-f5cc183f-c0e8-418f-8fd1-c18f170b2e88.png)
  
주문 고객은 고객 아디이와 동일한 속성이다.  

![스크린샷 2023-02-14 오후 8 22 00](https://user-images.githubusercontent.com/115435784/218722636-550e9911-ae4e-4c41-bfa7-8785a3891773.png)
  
외래키의 역할 : 고객 릴레이션과 주문 릴레이션이 관계를 맺어 주문 릴레이션의 투플과 연관성 있는 고객 릴레이션의 투플을 연결할 수 있음   
외래키 속성과 그것이 참조하는 기본키 속성의 이름은 달라도 되지만, 도메인은 같아야 한다. 


![스크린샷 2023-02-14 오후 8 25 11](https://user-images.githubusercontent.com/115435784/218723619-58723bcd-50b1-4021-a2cc-a32e43afd2ff.png)

![스크린샷 2023-02-14 오후 8 27 44](https://user-images.githubusercontent.com/115435784/218724163-9074c65e-2c42-458d-9e8b-a98aa8976d74.png)
  
- **키의 특성과 종류**  
  ![스크린샷 2023-02-14 오후 8 28 42](https://user-images.githubusercontent.com/115435784/218724368-b24894aa-150e-44b1-9621-76da3ed99752.png)
  
  
- **무결성 제약조건(integrity constraint)** 
  - 데이터의 무결성을 보장하고 일관된 상태로 유지하기 위한 규칙  
  - 무결성 : 데이터를 결함이 없는 상태, 즉 정확하고 유효하게 유지하는 것   

![스크린샷 2023-02-14 오후 8 31 14](https://user-images.githubusercontent.com/115435784/218725074-1dd238ec-4609-460d-a27e-e83639d766d8.png)

  
- **개체 무결성 제약조건 (entity integrity constraint)**
  ![스크린샷 2023-02-14 오후 8 34 08](https://user-images.githubusercontent.com/115435784/218725931-47abc06b-90bc-40df-a882-86bffcbfc9ea.png)
  
고객 아이디를 NULL을 가지고 있으면, 개체 무결성 제약조건을 위배했다고 볼 수 있다.   
  
- **참조 무결성 제약조건(referential integrity constraint)** 
  - 외래키는 참조할 수 없는 값을 가질 수 없는 규칙   

![스크린샷 2023-02-14 오후 8 35 41](https://user-images.githubusercontent.com/115435784/218726269-aaf76f6d-e2f8-4923-93d9-aafaf0220480.png)

![스크린샷 2023-02-14 오후 8 36 36](https://user-images.githubusercontent.com/115435784/218726458-fb564359-f342-4ad5-8577-2c2e53bbc237.png)
  
--- 
# 5장. 관계 데이터 모델 : 실습   
- E-R 모델과 릴레이션 변환 규칙을 이용한 설계의 과정
  <img width="600" alt="스크린샷 2023-02-15 오후 12 34 50" src="https://user-images.githubusercontent.com/115435784/218921281-14a54433-0b74-4f84-a214-f40a5100a44c.png">
  
- **설계 3단계 : 논리적 단계**  
  - 목적 
    - DBMS에 적합한 논리적 스키마 설계 
    - 개념적 스키마를 논리적 데이터 모델을 이용해 논리적 구조로 표현 
    - 일반적으로 관계 데이터 모델을 이용  
  
  - 결과물 
    - 논리적 스키마 : 릴레이션 스키마 
    - 개념적 설계 단계의 결과물인 E-R 다이어그램을 릴레이션 스키마로 변환 
    - 릴레이션 스키마 변환 후 속성의 데이터 타입, 길이, 널 값 허용 여부, 기본 값, 제약조건 등을 세부적으로 결정하고 결과를 문서화 시킴   
  
    - E-R 다이어그램을 릴레이션 스키마로 변환하는 규칙 
      - 규칙 1 : 모든 개체는 릴레이션으로 변환한다.  
      - 규칙 2 : 다대다(n:m) 관계는 릴레이션으로 변환하낟.
      - 규칙 3 : 일대다(1:n)관계는 외래키로 표현한다.  
      - 규칙 4 : 일대일 관계는 외래키로 표현한다. 
      - 규칙 5 : 다중값 속성은 릴레이션으로 변환한다. 
      - 변환 규칙을 순서대로 적용하되, 해당되지 않는 규칙은 제외  
  
- 논리적 설계 - 규칙1 ) 모든 개체는 릴레이션으로 변환한다. 
  - E-R 다이어그램의 각 개체를 하나의 릴레이션으로 변환  
    - 개체의 이름 -> 릴레이션 이름 
    - 개체의 속성 -> 릴레이션의 속성 
    - 개체의 키 속성 -> 릴레이션의 기본키 
    - 개체의 속성이 복합 속성인 경우에는 복합 속성을 구성하고 있는 단순 속성만 릴레이션의 속성으로 변환  

<img width="556" alt="스크린샷 2023-02-15 오후 1 11 39" src="https://user-images.githubusercontent.com/115435784/218927731-f7eb234f-5ee5-4c6e-bbd7-5286d3d8a196.png">

<img width="598" alt="스크린샷 2023-02-15 오후 1 13 44" src="https://user-images.githubusercontent.com/115435784/218928072-5364516b-9d9b-4b1e-b53f-8c03b22a9f96.png">
  
밑의 사진은 고객이라는 개체를 고객 릴레이션으로 표현한 것이다.  
---

규칙1 표현 결과
<img width="618" alt="스크린샷 2023-02-15 오후 1 15 53" src="https://user-images.githubusercontent.com/115435784/218928418-0489637e-6929-44c2-8d79-d69e718a5b22.png">
  

---  
- **규칙 2 : 다대다 관계는 릴레이션으로 변환한다.**  
  - E-R 다이어그램의 다대다 관계를 하나의 릴레이션으로 변환 
    - 관계의 이름 -> 릴레이션의 이름 
    - 관계의 속성 -> 릴레이션의 속성 
    - 관계에 참여하는 개체를 규칙 1에 따라 릴레이션으로 변환한 후 이 릴레이션의 기본키를 관계 릴레이션에 포함시켜 외래키로 지정하고,  
    - 외래키들을 조합하여 관계 릴레이션의 기본키로 지정  

<img width="571" alt="스크린샷 2023-02-15 오후 1 18 41" src="https://user-images.githubusercontent.com/115435784/218928934-75380c22-bc84-4ed6-9fe8-a07ff98e3f61.png">
  
하나의 고객은 여러개의 상품을 주문할 수 있고,  
하나의 상품은 여러 고객으로부터 주문되어 질 수 있다.  

<img width="613" alt="스크린샷 2023-02-15 오후 1 21 09" src="https://user-images.githubusercontent.com/115435784/218929397-1ca9f2cc-9fb1-48ff-84e0-235a904e8501.png">
  
다대다 관계가 한개만 존재하기 때문에, 주문이라는 릴레이션을 추가적으로 생성하였다. 
회원 릴레이션과 상품 릴레이션이 관계되었기 때문에, 각각 개체들의 기본키를 외래키로 가지게 된다.   
---  
- **규칙 3 : 일대다 관계는 외래키로 표현한다.** 
  - E-R 다이어그램의 일대다 관계는 외래키로만 표현 
    - 3-1 : 일반적인 일대다 관계는 외래키로 표현한다.  
    - 약한 개체가 참여하는 일대다 관계는 외래키를 포함해서 기본키로 지정한다.    
  
- 3-1 일반적인 일대다 관계는 외래키로 표현한다.  
  - 일대다 관계에서 1측 개체 릴레이션의 기본키를 n측 개체 릴레이션에 포함시켜 외래키로 지정 
  - 관계의 속성들도 n측 개체 릴레이션에 포함시킴  
   
학생이라는 개체가 있고 교수라는 개체가 있고 둘은 지도학생이라는 관계  
한명의 교수는 여러명의 학생을 지도할 수 있지만,  
한명의 학생은 한명의 교수한테만 지도를 받을 수 있다.  
이런 경우 일대다 관계  
---  

<img width="591" alt="스크린샷 2023-02-15 오후 1 27 41" src="https://user-images.githubusercontent.com/115435784/218930457-37b955c6-a565-4620-a59e-16f1f5826681.png">
   
제조업체와 상품이 일대다 관계  
공급이 가지고 있는 속성도 n측에 포함시킨다.  

  
---
- 규칙 3-2 : 약한 개체가 참여하는 일대다 관계는 외래키를 포함해서 기본키를 지정한다.  
  - 일대다 관계에서 1측 개체 릴레이션의 기본키를 n측 개체 릴레이션에 포함시켜 외래키로 지정   
  - 관계의 속성들도 n측 개체 릴레이션에 포함시킨다. 
  - n측 개체 릴레이션은 외래키를 포함하여 기본키를 지정한다.  
    - 약한 개체는 오너 개체에 따라 존재 여부가 결정되므로, 오너 개체의 기본키를 이용해서 식별해야 한다.  
    

---  
- **규칙 4 : 일대일 관계는 외래키로 표현한다.**
  E-R 다이어글매의 일대일 관계는 외래키로만 표현 
  - 4-1 : 일반적인 일대일 관계는 외래키를 서로 주고받는다. 
  - 4-2: 일대일 관계에 ㅣㄹ수적으로 참여하는 개체의 릴레이션만 외래키를 받는다. 
  - 4-3: 모든 개체가 일대일 관계에 필수적으로 참여하면 릴레이션을 하나로 합친다.  
  
- 4-1 : 일반적인 일대일 관계는 외래키를 서로 주고받는다. 
  - 관계에 참여하는 개체 릴레이션들이 서로의 기본키를 주고 받아 외래키로 지정 
  - 관계의 속성들도 모든 개체 릴레이션에 포함시킴 

<img width="584" alt="스크린샷 2023-02-15 오후 1 45 09" src="https://user-images.githubusercontent.com/115435784/218933269-f9574282-e4d4-47c5-a4ee-e9c6285013ee.png">
  
남자와 여자는 선택적으로 혼인이라는 관계에 참여하게 된다.   
  
이 경우는 남자는 여자번호를 외래키로  
여자는 남자번호를 외래키로 가지게 되고  
혼인의 속성인 결혼 날짜를 양쪽 모두 속성으로 가지게 된다.    
이렇게 되면  
남자가 여자랑 결혼했다는 정보가 남자 릴레이션에 포함되고  
여자가 남자랑 결혼했다는 정보가 여자 릴레이션에 포함되게 된다.   
  
- 4-2 : 필수적으로 참여하는 개체 릴레이션만 외래키를 받는다.  
  - 관계에 필수적으로 참여하는 개체 릴레이션에만 외래키를 포함시킴 
  - 관계의 속성들은 관계에 필수적으로 참여하는 개체 릴레이션에 포함시킴   

<img width="596" alt="스크린샷 2023-02-15 오후 1 48 20" src="https://user-images.githubusercontent.com/115435784/218933857-842650da-9080-4d80-8505-50dc4c2e58ab.png">
  
- **4-3 : 모든 개체가 필수적으로 참여하면 릴레이션을 하나로 합친다.** 
  - 관계에 참여하는 개체 릴레이션들을 하나의 릴레이션으로 합쳐서 표현 
  - 관계의 이름을 릴레이션 이름으로 사용하고, 관계에 참여하는 두 개체의 속성들을 관계 릴레이션에 모두 포함시킴
  - 두 개체 릴레이션의 키 속성을 조합하여 관계 릴레이션의 기본키로 지정  

<img width="614" alt="스크린샷 2023-02-15 오후 1 52 12" src="https://user-images.githubusercontent.com/115435784/218934610-12c3c8c5-1a34-4e82-8608-f1440e30ef61.png">
  
혼인 릴레이션에서 남자번호와 여자번호를 기본키로 사용하고,  
남자의 속성, 여자의 속성, 혼인의 속성을 혼인 릴레이션의 속성으로 포함해서 릴레이션을 구성하게 된다.  
  
---  
- **규칙 5 : 다중값 속성은 릴레이션으로 변환한다.**  
  - E-R 다이어그램의 다중값 속성은 독립적인 릴레이션으로 변환 
    - 다중값 속성과 함께 그 속성을 가지고 있던 개체 릴레이션의 기본키를 외래키로 가져와 새로운 릴레이션에 포함시킴 
    - 새로운 릴레이션의 기본키는 다중값 속성과 외래키를 조합하여 지정  

<img width="599" alt="스크린샷 2023-02-15 오후 1 55 28" src="https://user-images.githubusercontent.com/115435784/218935319-adcfbd52-d243-44df-9f19-24f759c4ae5a.png">

<img width="611" alt="스크린샷 2023-02-15 오후 1 57 42" src="https://user-images.githubusercontent.com/115435784/218935708-e6f34ef2-43bb-4bb2-b749-57f38dc69db3.png">

<img width="586" alt="스크린샷 2023-02-15 오후 1 58 12" src="https://user-images.githubusercontent.com/115435784/218935795-11c4f7f0-ca00-420d-82a5-6480b7a2b155.png">
중복이 되는 문제가 있기 때문에 이 릴레이션을 분할한다.  

<img width="603" alt="스크린샷 2023-02-15 오후 1 58 57" src="https://user-images.githubusercontent.com/115435784/218935932-8c26ebfc-e199-4c47-977c-23f8ea8fbc38.png">

<img width="616" alt="스크린샷 2023-02-15 오후 2 00 01" src="https://user-images.githubusercontent.com/115435784/218936088-07461532-e1a1-4f4e-9b20-272644953c43.png">

<img width="589" alt="스크린샷 2023-02-15 오후 2 00 37" src="https://user-images.githubusercontent.com/115435784/218936202-9b1d77a7-bad8-43e2-ae33-d7635ed36b35.png">

<img width="1202" alt="스크린샷 2023-02-15 오후 2 01 26" src="https://user-images.githubusercontent.com/115435784/218936312-fba91a11-2f8d-4487-a7ce-28b651cf0c72.png">
